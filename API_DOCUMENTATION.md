# API Documentation (Movie App)

This document describes the built-in API routes in this project (mock implementations). Routes are located under `app/api/*` in the repository. These endpoints are simple, in-memory mock handlers intended for local/demo use.

---

## Overview

Base path: `/api`

- Authentication routes:
  - `POST /api/auth/login` — login with email/password (returns a mock token and user object)
  - `POST /api/auth/logout` — logout (mock)

- Movies routes:
  - `GET /api/movies` — list movies with pagination
  - `POST /api/movies` — create a new movie

Note: The API currently uses in-memory arrays (no database). On server restart, movie data will reset.

---

## Authentication

These endpoints are located in `app/api/auth`.

### POST /api/auth/login

Description: Validate credentials against a small mock user store and return a user object and a mock token.

Request body (JSON):

```json
{
  "email": "admin@example.com",
  "password": "password123"
}
```

Successful response (200):

```json
{
  "success": true,
  "message": "Login successful",
  "user": { "id": 1, "email": "admin@example.com", "name": "Admin User" },
  "token": "mock-jwt-token-1"
}
```

Error responses:
- 400: { error: 'Email and password are required' }
- 401: { error: 'Invalid email or password' }
- 500: { error: 'Internal server error' }

Notes:
- Passwords are stored in plain text in the mock (for demo only). Do not use this pattern in production.
- The endpoint returns a `token` string for demo. In production you should generate a signed JWT or set secure HTTP-only cookies.

### POST /api/auth/logout

Description: Mock logout endpoint. Always returns success in the demo.

Response (200):

```json
{ "success": true, "message": "Logout successful" }
```

Error responses:
- 500: { error: 'Internal server error' }

---

## Movies API

This file is located at `app/api/movies/route.js`. It uses a module-scoped `movies` array as an in-memory store.

### GET /api/movies

Description: Return a paginated list of movies.

Query parameters:
- `page` (optional) — page number (default: 1)
- `limit` (optional) — items per page (default: 10)

Response (200):

```json
{
  "success": true,
  "movies": [ /* array of movie objects for the requested page */ ],
  "pagination": {
    "currentPage": 1,
    "totalPages": 2,
    "totalMovies": 12,
    "limit": 10,
    "hasNextPage": true,
    "hasPrevPage": false
  }
}
```

Example request:

```js
// fetch page 2 with 5 per page
fetch('/api/movies?page=2&limit=5').then(r => r.json()).then(console.log);
```

Error responses:
- 500: { error: 'Failed to fetch movies' }

### POST /api/movies

Description: Add a new movie to the in-memory store.

Request body (JSON):

```json
{
  "title": "Inception",
  "year": "2010",
  "image": "https://..." // optional
}
```

Validation rules (implemented in route.js):
- `title` and `year` are required — 400 if missing.
- `year` must be a 4-digit number — 400 if invalid.
- `year` must be between 1888 and (current year + 5) — 400 if out of range.

Successful response (200):

```json
{
  "success": true,
  "message": "Movie added successfully",
  "movie": {
    "id": 1,
    "title": "Inception",
    "year": "2010",
    "image": "https://..."
  }
}
```

Error responses:
- 400: { error: 'Title and year are required' }
- 400: { error: 'Year must be a 4-digit number' }
- 400: { error: 'Year must be between 1888 and <X>' }
- 500: { error: 'Failed to add movie' }

Notes:
- IDs are generated by `movies.length + 1` so they will not be globally unique in a real database scenario.

---

## Example JavaScript usage (fetch)

Login:

```js
async function login(email, password) {
  const res = await fetch('/api/auth/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email, password })
  });
  return res.json();
}
```

Logout:

```js
await fetch('/api/auth/logout', { method: 'POST' }).then(r => r.json());
```

List movies (page 1, 10 items):

```js
const data = await fetch('/api/movies?page=1&limit=10').then(r => r.json());
console.log(data.movies, data.pagination);
```

Add movie:

```js
const payload = { title: 'My Movie', year: '2024', image: '' };
const res = await fetch('/api/movies', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(payload)
});
const data = await res.json();
console.log(data);
```

---

## Errors and status codes

- 200 — success (many handlers return 200 with { success: true }).
- 400 — client validation errors (missing fields or invalid format).
- 401 — auth failure (login only).
- 500 — server/internal errors.

---

## Implementation notes & how to extend

- Files:
  - `app/api/auth/login/route.js`
  - `app/api/auth/logout/route.js`
  - `app/api/movies/route.js`

- The API uses Next.js route handlers (`GET`, `POST` exported functions). Replace the in-memory arrays with a real database (Postgres, MongoDB, etc.) and move validation to a shared layer.

- Authentication:
  - Replace the mock token with signed JWT tokens (use a library like `jsonwebtoken`) or implement server sessions with secure HTTP-only cookies.
  - Protect sensitive routes by checking an `Authorization: Bearer <token>` header or cookies in each API handler.

- Adding edit/delete endpoints:
  - Add `PUT /api/movies/:id` to update a movie and `DELETE /api/movies/:id` to remove a movie. For Next.js route handlers you can create `app/api/movies/[id]/route.js` and export `PUT`/`DELETE` handlers that read `request` and the `params` param (see Next.js docs).

---

## Where to look in the code

- Login logic: `app/api/auth/login/route.js`
- Logout logic: `app/api/auth/logout/route.js`
- Movies list/create: `app/api/movies/route.js`

---

## Testing locally

Start the Next.js app (project uses Next 13+ app router):

```powershell
# from project root
npm install
npm run dev
```

Use the app UI or the example `fetch` snippets above to call endpoints.

---

If you'd like, I can also:
- Add OpenAPI (Swagger) JSON and a small UI
- Add `PUT` and `DELETE` handlers for full CRUD
- Add proper JWT-based auth and secure cookie handling

Tell me which of those you'd like next and I will implement it.
